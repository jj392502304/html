<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>净水器销售登录注册</title>
  <meta name="description" content="particles.js is a lightweight JavaScript library for creating particles.">
  <meta name="author" content="Vincent Garreau" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" media="screen" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/reset.css"/>
	<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="js/wintrue.js"></script>
	<script src="../js/public.js"></script>
	<script type='text/javascript'>
        var code ; //在全局定义验证码

        function createCode(){
            code = "";
            var codeLength = 4;//验证码的长度
            var checkCode = document.getElementById("code");
            var random = new Array(0,1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R',
                'S','T','U','V','W','X','Y','Z');//随机数
            for(var i = 0; i < codeLength; i++) {//循环操作
                var index = Math.floor(Math.random()*36);//取得随机数的索引（0~35）
                code += random[index];//根据索引取得随机数加到code上
            }
            checkCode.value = code;//把code值赋给验证码
        }
        function checkpassord() {
            if($("#password1").val().length<6){
                $("#password1").focus();
                $("#tishi4").html("不能小于6位")
                return false;
            }else{
                $("#tishi4").html("");

			}
			if($("#password1").val()!=$("#password2").val()){
			    $("#password2").focus();
             	$("#tishi").html("密码不一致")
				return false;

			}else{
                $("#tishi").html("")

			}
			return true;
        }

	</script>
	<style type='text/css'>
		#code{
			margin-left:10px ;
			width: 70px;
			background: dodgerblue;
			color: white;
			border-width: 0px;
			border-radius: 3px;
			outline: none;
			font-family: Microsoft YaHei;
			cursor: pointer;
			font-size: 14px;
		}
		.btn-a{
			background: dodgerblue;
			color: white;
			border-width: 0px;
			border-radius: 3px;
			outline: none;
			font-family: Microsoft YaHei;
			cursor: pointer;
			font-size: 14px;
		}
		.btn-a:hover{
			background: #5599FF;
		}
	</style>
</head>
<body onload="createCode()">

<div id="particles-js">
		<div class="login" style="height: 600px">
			<div class="login-top" >
				注册
			</div>
			<div class="login-center clearfix">
				<div class="login-center-img"><img src="img/name.png"/></div>
				<div class="login-center-input">
					<input id="phone" onchange="checkMobile()" style="width: 62%" type="text" name="" value="" placeholder="请输入手机号" onfocus="this.placeholder=''" onblur="this.placeholder='请输入手机号'"/>
					<button class="btn-a" >获取验证码</button>
					<p id="tishi3" style="color: red"></p>
					<div class="login-center-input-text">手机号</div>
				</div>
			</div>
			<div class="login-center clearfix">
				<div class="login-center-img"><img src="img/password.png"/></div>
				<div class="login-center-input">
					<input id="password1" onchange="checkpassord()" style=" width: 62%"type="password" name=""value="" placeholder="请输入您的密码" onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的密码'"/>
					<label style="color: red" id="tishi4"></label>
					<div class="login-center-input-text">密码</div>
				</div>
			</div>
			<div class="login-center clearfix">
				<div class="login-center-img"><img src="img/password.png"/></div>
				<div class="login-center-input">
					<input id="password2" onchange="checkpassord()" style=" width: 62%"type="password" name=""value="" placeholder="请确认您的密码" onfocus="this.placeholder=''" onblur="this.placeholder='请确认您的密码'"/>
					<label style="color: red" id="tishi"></label>
					<div class="login-center-input-text">确认密码</div>
				</div>
			</div>
			<div class="login-center clearfix">
				<div class="login-center-img"><img src="img/timg.jpg"/></div>
				<div class="login-center-input">
					<input style=" width: 62%"type="text" name=""value="" placeholder="请输入手机验证码" onfocus="this.placeholder=''" onblur="this.placeholder='请输入手机验证码'"/>
					<div class="login-center-input-text">手机验证码</div>
				</div>
			</div>
			<div class="login-center clearfix">
				<div class="login-center-img"><img src="img/timg.jpg"/></div>
				<div class="login-center-input">
					<input id="validate" style="width: 62%" type="text" name=""value="" placeholder="请输入右侧验证码" onfocus="this.placeholder=''" onblur="this.placeholder='请输入右侧验证码'"/>
					<div class="login-center-input-text">验证码</div>
					<input type="button" id="code" onclick="createCode()" title='点击更换验证码' />
					<p id="tishi2" style="color: red"></p>
				</div>
			</div>

			<div class="login-button">
				登录
			</div>
		</div>
		<div class="sk-rotating-plane"></div>
</div>

<!-- scripts -->
<script src="js/particles.min.js"></script>
<script src="js/app.js"></script>
<script type="text/javascript">
    function checkMobile(){
        $("#tishi3").html("")
        var sMobile = $("#phone").val();
        if(!(/^1[3|5][0-9]\d{4,8}$/.test(sMobile))){

            $("#phone").focus();
            $("#tishi3").html("手机号码格式不对")
            return false;
        }else if(sMobile.length!=11){
            $("#phone").focus();
            $("#tishi3").html("手机号码格式不对")
            return false;
		} else{
            $("#tishi3").html("")
            return true;
		}
    }
    function hasClass(elem, cls) {
	  cls = cls || '';
	  if (cls.replace(/\s/g, '').length == 0) return false; //当cls没有参数时，返回false
	  return new RegExp(' ' + cls + ' ').test(' ' + elem.className + ' ');
	}
	 
	function addClass(ele, cls) {
	  if (!hasClass(ele, cls)) {
	    ele.className = ele.className == '' ? cls : ele.className + ' ' + cls;
	  }
	}
	 
	function removeClass(ele, cls) {
	  if (hasClass(ele, cls)) {
	    var newClass = ' ' + ele.className.replace(/[\t\r\n]/g, '') + ' ';
	    while (newClass.indexOf(' ' + cls + ' ') >= 0) {
	      newClass = newClass.replace(' ' + cls + ' ', ' ');
	    }
	    ele.className = newClass.replace(/^\s+|\s+$/g, '');
	  }
	}
		document.querySelector(".login-button").onclick = function(){
            if($("#password1").val()!=$("#password2").val()){
                return;
            }
            if($("#validate").val().toLowerCase()!=code.toLowerCase()){
                $("#validate").focus();
                $("#tishi2").html("验证码不正确")
                return;
            }else {
                $("#tishi2").html("")
			}

            if(checkpassord()==false){
                return;
            }
            if(checkMobile()==false){
                return;
			}
			var account=$("#phone").val();
            var password=$("#password1").val();
            var suser={
                "account":account,
				"password":password
			}

            $.ajax({
                type: "POSt",
                url: http+"/suser/add",
                data: JSON.stringify(suser),
                contentType: "application/json",
                dataType: "json",
                success: function(data) {
                    if (data.code == 200) {
                        alert("注册成功")
                    	window.location.href = "index.html";
                	}else{
                        if(data.message=="手机号码已经被注册"){
                            $("#tishi3").html(data.message)
						}else{
                            alert("服务器繁忙，请稍后再试");
						}

					}
                }
            });



//				addClass(document.querySelector(".login"), "active")
//				setTimeout(function(){
//					addClass(document.querySelector(".sk-rotating-plane"), "active")
//					document.querySelector(".login").style.display = "none"
//				},800)
//				setTimeout(function(){
//					removeClass(document.querySelector(".login"), "active")
//					removeClass(document.querySelector(".sk-rotating-plane"), "active")
//					document.querySelector(".login").style.display = "block"
//					alert("注册成功")
//					window.location.href="index.html";
//				},3000)
		}
</script>
<div style="text-align:center;">
</div>
</body>
</html>